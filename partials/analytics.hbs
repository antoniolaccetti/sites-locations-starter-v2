<script src="/util.js"></script>
<!--<script src="/analytics.js"></script>-->

<script>
    (function(w,d,y){
        w['YextAnalyticsObject']=y;
        w[y]=w[y]||function(){
        (w[y].q=w[y].q||[]).push(arguments)
        };
        w[y]('create', '{{businessId}}', '{{siteId}}', isStaging());
    })(window, document, 'ya');
    {{#if uid}}
        ya('set', { id: '{{uid}}' })
    {{/if}}
    ya('pageview');
</script>

<script type="text/javascript">

    var head = document.getElementsByTagName('head')[0];
    var js = document.createElement("script");
   
    function OptanonWrapper() {
        // console.log(document.cookie);
        //   console.log(document.cookie);
        window.dataLayer.push({ event: 'OneTrustGroupsUpdated' });
        // delete_cookie();


        var handlerCookie = false;


        const banner = document.getElementById("onetrust-banner-sdk");

        if (banner) {
            banner.addEventListener('change', getCookie("OptanonConsent"));
            console.log("bannerChange");
        }        

        getCookie("OptanonConsent");

        function getCookie(cookieName) {
            var dc = document.cookie;
            if (dc) {
                js.src = "/analytics.js";
                head.appendChild(js);
                console.log("si cookie");
                clearInterval(cookieIfExist); 
                handledCookie = true;        
                var prefix = cookieName + "=";
                var begin = dc.indexOf("; " + prefix);
                var cookieString = dc.substring(begin).split("; ").pop();
                result = cookieString.indexOf("groups");
                cookieString = cookieString.substring(result).split("&");
                cookieString = cookieString[0].split("=").pop().split("C0001%3A");
                cookieString = cookieString[1].split("%2CC0002%3A");
                cookieString = cookieString[1].split("%2CC0004%3A");
                var cookiePrestazione = cookieString[0];
                var cookieTerzi = cookieString[1];

                if (cookieTerzi == 1 || cookiePrestazione == 1) {
                    console.log("startYext");
                   // startYext();                  
                }
            } else {
                if (handlerCookie == false) {
                    cookieIfExist = setInterval(function () { getCookie("OptanonConsent"); console.log("no cookieInterval") }, 5000);
                    console.log("no cookie")
                }
            }
             
        }

       


    }

    function startYext() {    
       
        
    }
</script>
<!-- OptanonConsentNoticeEnd -->